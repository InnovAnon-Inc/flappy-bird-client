var Flappy;!function(t){class e extends Phaser.Sprite{constructor(t,e,i,a,s){super(t,e,i,s.key),this.game.physics.enable(this,Phaser.Physics.ARCADE),this.animations.add("fly"),this.animations.play("fly",3,!0),this.anchor.set(.5,.5),this.hitSound=this.game.add.audio(s.hitSoundKey),this.dieSound=this.game.add.audio(s.dieSoundKey),this.wingSound=this.game.add.audio(s.windSoundKey);let o=new Phaser.Sprite(t,0,0,s.colorKey);o.anchor.set(.5,.5),o.animations.add("fly"),o.animations.play("fly",3,!0),o.blendMode=PIXI.blendModes.OVERLAY,o.alpha=.7,this.game.physics.enable(o,Phaser.Physics.ARCADE),o.body.allowGravity=!1,o.tint=a,this.addChild(o)}jump(t){this.wingSound.play("",0,t)}deathSequence(t){this.hitSound.play("",0,t),setTimeout(()=>{this.dieSound.play("",0,t)},300)}}t.BaseBird=e}(Flappy||(Flappy={}));var Flappy;!function(t){const e=-70;class i extends t.BaseBird{constructor(t,e,i,a){super(t,100,0,i,a),this.floorHeight=e,this.currentSpeed=0,this.restart(),this.game.add.existing(this)}update(){this.body.velocity.y>=t.Global.Constants.terminalVelocity&&(this.body.velocity.y=t.Global.Constants.terminalVelocity),this.y<=-100&&(this.y=-100),this.y>=t.Global.Constants.gameHeight-this.floorHeight&&(this.y=t.Global.Constants.gameHeight-this.floorHeight),this.angle=this.calculateAngle(this.body.velocity.y),this.x+=this.game.time.elapsed*this.currentSpeed,t.Global.socket.emit("position",{angle:this.angle,x:this.x,y:this.y})}deathSequence(){this.isStopped||(this.stop(),super.deathSequence(),this.game.input.onDown.remove(this.jumpLambda,this),t.Global.socket.emit("death"))}jump(){super.jump(),this.body.velocity.y=-t.Global.Constants.jumpSpeed}stop(){this.currentSpeed=0}get isStopped(){return 0===this.currentSpeed}restart(){let t=this.getRandomStartingY(this.floorHeight),e=this.getRandomStartingX();this.reset(e,t),this.body.allowGravity=!1,this.idleTween=this.game.add.tween(this).to({y:this.y-10},1e3,Phaser.Easing.Linear.None,!1,0,-1,!0),this.idleTween.start(),this.game.input.onDown.add(this.jumpLambda,this)}calculateAngle(i){let a=t.Global.Utility.map(i,-t.Global.Constants.jumpSpeed,t.Global.Constants.terminalVelocity,e,90);return a}jumpLambda(){this.body.allowGravity===!1&&(this.body.allowGravity=!0,this.currentSpeed=t.Global.Constants.gameSpeed,this.idleTween.stop()),t.Global.socket.emit("jump"),this.jump()}getRandomStartingY(e){let i=t.Global.Constants.gameHeight-e,a=t.Global.Utility.map(Math.random(),0,1,.2,.8);return a*i}getRandomStartingX(){let e=200,i=t.Global.Utility.map(Math.random(),0,1,.2,.8);return i*e}}t.Bird=i}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends t.BaseBird{constructor(t,e,i,a,s,o){super(t,e,i,s,o),this.displayName=a,this.body.allowGravity=!1,this.nameTag=new Phaser.Text(t,0,-35,a,{font:"12px flappy",fill:"white"}),this.nameTag.stroke="black",this.nameTag.strokeThickness=2,this.nameTag.anchor.x=.5,this.addChild(this.nameTag)}deathSequence(){let t=this.calculateVolume();super.deathSequence(t)}jump(){let t=this.calculateVolume();super.jump(t)}update(){this.nameTag.angle=-this.angle,this.nameTag.x=-35*Math.sin(this.angle*(Math.PI/180)),this.nameTag.y=-35*Math.cos(this.angle*(Math.PI/180))}calculateVolume(){let e=this.game.camera.x+t.Global.Constants.gameWidth/2,i=Math.abs(e-this.x),a=Math.min(Math.max(i,0),1e3),s=t.Global.Utility.map(a,0,1e3,0,.8),o=1-s;return o}}t.MultiplayerBird=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.TileSprite{constructor(e,i,a){super(e,t.Global.Constants.worldOffset,t.Global.Constants.gameHeight,t.Global.Constants.gameWidth,i,a),this.game.physics.enable(this,Phaser.Physics.ARCADE),this.body.immovable=!0,this.body.allowGravity=!1,this.anchor.y=1,this.game.add.existing(this)}update(){this.width=this.game.world.width,this.body.width=this.game.world.width}}t.Floor=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.Game{constructor(e){let i=document.getElementById(e);super(t.Global.Constants.gameWidth,t.Global.Constants.gameHeight,Phaser.AUTO,i.id,t.State.Blank,!1,!1),this.state.add("play",t.State.Play),window.addEventListener("resize",e=>{this.scale.setGameSize(t.Global.Constants.gameWidth,t.Global.Constants.gameHeight)})}connect(e,i){t.Global.socket=io.connect(t.Global.Constants.serverUrl,{query:`name=${e.name}&color=${e.color}`}),t.Global.socket.on("connect",()=>{this.state.start("play"),i(t.Global.socket)}),t.Global.connectionDetails=e}}t.Game=e}(Flappy||(Flappy={}));var Flappy;!function(t){var e;!function(t){class e{static get serverUrl(){return"http://127.0.0.1:8080/"===window.location.href?"http://localhost:9001":"https://flappy-bird-server.herokuapp.com"}static get gameWidth(){let t=this.gameHeight/window.innerHeight;return window.innerWidth*t}}e.gameSpeed=.1,e.jumpSpeed=500,e.gapSize=155,e.gravity=2e3,e.pipeSpacing=200,e.terminalVelocity=700,e.gameHeight=665,e.worldOffset=-1e3,t.Constants=e}(e=t.Global||(t.Global={}))}(Flappy||(Flappy={}));var Flappy;!function(t){var e;!function(t){}(e=t.Global||(t.Global={}))}(Flappy||(Flappy={}));var Flappy;!function(t){var e;!function(t){class e{static map(t,e,i,a,s){return(t-e)*(s-a)/(i-e)+a}}t.Utility=e}(e=t.Global||(t.Global={}))}(Flappy||(Flappy={}));var Flappy;!function(t){class e{constructor(t,e){this.scoreCounter=t,this.pipePool=e,this.requesting=!1}request(e,i,a){$.get(`${t.Global.Constants.serverUrl}/stage?start=${e}&end=${i}`,t=>{a(t)})}update(t){if(this.requesting!==!0&&Math.abs(this.scoreCounter.score-this.pipePool.length)<=10){let e=this.pipePool.length;this.request(e,e+20,e=>{t(e),this.requesting=!1}),this.requesting=!0}}}t.LevelRequester=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.Group{constructor(t,e,i,a){super(t),this.pipeBody=new Phaser.TileSprite(t,e,i,52,window.innerHeight,a.pipeBodyKey),this.pipeCap=new Phaser.Sprite(t,e,i,a.pipeCapKey),this.pipeBody.anchor.y=1,this.add(this.pipeBody),this.add(this.pipeCap),this.game.physics.enable(this,Phaser.Physics.ARCADE),this.pipeBody.body.allowGravity=!1,this.pipeCap.body.allowGravity=!1}get sprites(){return[this.pipeBody,this.pipeCap]}}t.DownPipe=e}(Flappy||(Flappy={}));var Flappy;!function(t){const e=500;class i extends Phaser.Group{constructor(t,e){super(t),this.floorHeight=e,this.game=t,this.game.physics.enable(this,Phaser.Physics.ARCADE)}addPipes(i){for(let a of i){let i=t.Global.Constants.gameHeight-this.floorHeight-t.Global.Constants.gapSize,s=t.Global.Utility.map(a.location,0,1,.1,.9);this.create(e+a.index*t.Global.Constants.pipeSpacing,s*i)}}create(e,i){let a=this.getFirstExists(!1);a||(a=new t.PipeSet(this.game,e,i,t.Global.Constants.gapSize,{pipeBodyKey:"pipeBody",pipeDownCapKey:"pipeDownCap",pipeUpCapKey:"pipeUpCap"}),this.add(a,!0))}get sprites(){let t=new Array;for(let e of this.children){let i=e;t=t.concat(i.sprites)}return t}get holes(){let t=new Array;for(let e of this.children){let i=e;t=t.concat(i.hole)}return t}}t.PipePool=i}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.Group{constructor(e,i,a,s,o){super(e),this.upPipe=new t.UpPipe(e,i,a+s,{pipeBodyKey:o.pipeBodyKey,pipeCapKey:o.pipeUpCapKey}),this.add(this.upPipe),this.pipeHole=new Phaser.Sprite(e,i+this.upPipe.width,a),this.pipeHole.width=1,this.pipeHole.anchor.x=1,this.pipeHole.height=s,this.game.physics.enable(this.pipeHole,Phaser.Physics.ARCADE),this.pipeHole.body.allowGravity=!1,this.add(this.pipeHole),this.downPipe=new t.DownPipe(e,i,a,{pipeBodyKey:o.pipeBodyKey,pipeCapKey:o.pipeDownCapKey}),this.add(this.downPipe)}get sprites(){return this.downPipe.sprites.concat(this.upPipe.sprites)}get hole(){return this.pipeHole}}t.PipeSet=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.Group{constructor(t,e,i,a){super(t),this.pipeBody=new Phaser.TileSprite(t,e,i,52,window.innerHeight,a.pipeBodyKey),this.pipeCap=new Phaser.Sprite(t,e,i,a.pipeCapKey),this.pipeCap.anchor.y=1,this.add(this.pipeBody),this.add(this.pipeCap),this.game.physics.enable(this,Phaser.Physics.ARCADE),this.pipeBody.body.allowGravity=!1,this.pipeCap.body.allowGravity=!1}get sprites(){return[this.pipeBody,this.pipeCap]}}t.UpPipe=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e{constructor(t,e){this.game=t,this.birdParams=e,this.players=new Map,this.group=this.game.add.group()}listen(){t.Global.socket.on("position",t=>{let e=this.players.get(t.id);void 0!==e&&(this.game.physics.arcade.moveToXY(e,t.x,t.y,6e3,20),e.angle=t.angle)}),t.Global.socket.on("new-player",t=>{this.createPlayer(t)}),t.Global.socket.on("jump",t=>{if(this.players.has(t.id)){let e=this.players.get(t.id);e.jump()}}),t.Global.socket.on("death",t=>{if(this.players.has(t.id)){let e=this.players.get(t.id);e.deathSequence()}}),t.Global.socket.on("disconnected",t=>{if(this.players.has(t.id)){let e=this.players.get(t.id);e.destroy()}})}createPlayersFromServer(){$.get(`${t.Global.Constants.serverUrl}/players`,t=>{this.createPlayers(t)})}createPlayers(e){for(let i of e){if(i.id===t.Global.socket.id)return;this.createPlayer(i)}}createPlayer(e){if(!this.players.has(e.id)){let i=new t.MultiplayerBird(this.game,-1e3,-1e3,e.name,e.color,this.birdParams);this.group.add(i),this.players.set(e.id,i)}}}t.PlayerManager=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.Sprite{constructor(t,e,i,a){super(t,e,i,a),this.anchor.x=.5,this.originalY=i,this.inputEnabled=!1,this.events.onInputOver.add(()=>{this.tween=this.game.add.tween(this).to({y:this.originalY-5},1e3,Phaser.Easing.Linear.None,!0,0,-1,!0),this.tint=15263976}),this.events.onInputOut.add(()=>{this.tween.pause(),this.game.add.tween(this).to({y:this.originalY},500,Phaser.Easing.Exponential.Out,!0),this.tint=16777215})}}t.ReplayButton=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.Group{constructor(e,i,a){super(e),this.gameOver=new Phaser.Sprite(e,t.Global.Constants.gameWidth/2,t.Global.Constants.gameHeight/2-100,i.gameOverKey),this.gameOver.anchor.set(.5,.5),this.gameOver.alpha=0,this.add(this.gameOver),this.scoreWindow=new t.ScoreWindow(e,t.Global.Constants.gameWidth/2,t.Global.Constants.gameHeight/2,{bronzeMedalKey:i.bronzeMedalKey,goldMedalKey:i.goldMedalKey,platinumMedalKey:i.platinumMedalKey,scoreWindowKey:i.scoreBoardKey,silverMedalKey:i.silverMedalKey}),this.scoreWindow.alpha=0,this.add(this.scoreWindow),this.replayButton=new t.ReplayButton(e,t.Global.Constants.gameWidth/2,t.Global.Constants.gameHeight/2+70,i.replayButtonKey),this.replayButton.alpha=0,this.replayButton.events.onInputDown.add(()=>{a(),setTimeout(()=>{this.gameOverStatus=!1},500),this.gameOver.alpha=0,this.scoreWindow.alpha=0,this.replayButton.alpha=0,this.replayButton.inputEnabled=!1}),this.add(this.replayButton),this.wooshSound=e.add.audio(i.wooshSoundKey),this.fixedToCamera=!0}show(e){this.gameOverStatus=!0,this.scoreWindow.score=e,this.gameOver.y=t.Global.Constants.gameHeight/2-80;let i=this.game.add.tween(this.gameOver).to({alpha:1,y:t.Global.Constants.gameHeight/2-100},500,Phaser.Easing.Exponential.Out,!0,500);i.onStart.add(()=>{this.wooshSound.play()}),this.scoreWindow.y=t.Global.Constants.gameHeight/2+20;let a=this.game.add.tween(this.scoreWindow).to({alpha:1,y:t.Global.Constants.gameHeight/2},500,Phaser.Easing.Exponential.Out,!0,1500);a.onStart.add(()=>{this.wooshSound.play()}),this.replayButton.y=t.Global.Constants.gameHeight/2+90;let s=this.game.add.tween(this.replayButton).to({alpha:1,y:t.Global.Constants.gameHeight/2+70},500,Phaser.Easing.Exponential.Out,!0,1500);s.onComplete.add(()=>{this.replayButton.inputEnabled=!0})}update(){this.gameOver.x=t.Global.Constants.gameWidth/2,this.gameOver.y=t.Global.Constants.gameHeight/2-100,this.scoreWindow.x=t.Global.Constants.gameWidth/2,this.scoreWindow.y=t.Global.Constants.gameHeight/2,this.replayButton.x=t.Global.Constants.gameWidth/2,this.replayButton.y=t.Global.Constants.gameHeight/2+70}get isGameOver(){return this.gameOverStatus}}t.ScoreBoard=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.Sprite{constructor(t,e,i,a){super(t,e,i,a.scoreWindowKey),this.anchor.set(.5,.5),this.highestScore=0,this.currentScore=new Phaser.Text(t,this.width/2-25,-this.height/2+37,"0",{font:"18px flappy",fill:"white"}),this.currentScore.stroke="black",this.currentScore.strokeThickness=5,this.currentScore.anchor.x=1,this.addChild(this.currentScore),this.bestScore=new Phaser.Text(t,this.width/2-25,-this.height/2+78,"0",{font:"18px flappy",fill:"white"}),this.bestScore.stroke="black",this.bestScore.strokeThickness=5,this.bestScore.anchor.x=1,this.addChild(this.bestScore),this.bronzeMedal=new Phaser.Sprite(t,-this.width/2+31,-this.height/2+49,a.bronzeMedalKey),this.bronzeMedal.visible=!1,this.addChild(this.bronzeMedal),this.silverMedal=new Phaser.Sprite(t,-this.width/2+31,-this.height/2+49,a.silverMedalKey),this.silverMedal.visible=!1,this.addChild(this.silverMedal),this.goldMedal=new Phaser.Sprite(t,-this.width/2+31,-this.height/2+49,a.goldMedalKey),this.goldMedal.visible=!1,this.addChild(this.goldMedal),this.platinumMedal=new Phaser.Sprite(t,-this.width/2+31,-this.height/2+49,a.platinumMedalKey),this.platinumMedal.visible=!1,this.addChild(this.platinumMedal)}set score(t){this.currentScore.text=t.toString(),t>this.highestScore&&(this.highestScore=t),this.resetMedalVisibility(),10<=t&&t<20?this.bronzeMedal.visible=!0:20<=t&&t<30?this.silverMedal.visible=!0:30<=t&&t<40?this.goldMedal.visible=!0:40<=t&&(this.platinumMedal.visible=!0),this.bestScore.text=this.highestScore.toString()}resetMedalVisibility(){this.bronzeMedal.visible=!1,this.silverMedal.visible=!1,this.goldMedal.visible=!1,this.platinumMedal.visible=!1}}t.ScoreWindow=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.Text{constructor(e){super(e,t.Global.Constants.gameWidth/2,30,"0",{font:"40px flappy",fill:"white"}),this.stroke="black",this.strokeThickness=8,this.anchor.x=.5,this.fixedToCamera=!0,this.checkPoints=new Map,this.pointSound=this.game.add.audio("point"),this.game.add.existing(this)}increment(t){this.checkPoints.has(t)||(this.checkPoints.set(t,!0),this.pointSound.play())}update(){this.cameraOffset.x=t.Global.Constants.gameWidth/2,this.text=this.score.toString()}get score(){return this.checkPoints.size}restart(){this.checkPoints=new Map}}t.ScoreCounter=e}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.TileSprite{constructor(e,i,a,s){super(e,0,t.Global.Constants.gameHeight-s,t.Global.Constants.gameWidth,i,a),this.fixedToCamera=!0,this.anchor.y=1,this.game.add.existing(this)}update(){this.width=t.Global.Constants.gameWidth}}t.Sky=e}(Flappy||(Flappy={}));var Flappy;!function(t){var e;!function(e){const i=112;class a extends Phaser.State{preload(){this.game.load.image("sky","assets/sky.png"),this.game.load.image("floor","assets/land.png")}create(){this.scale.scaleMode=Phaser.ScaleManager.EXACT_FIT,this.game.stage.backgroundColor="#4ec0ca",this.game.stage.disableVisibilityChange=!0,this.floor=new t.Floor(this.game,i,"floor"),this.sky=new t.Sky(this.game,109,"sky",i)}update(){this.game.world.width=t.Global.Constants.gameWidth,this.floor.x=0}}e.Blank=a}(e=t.State||(t.State={}))}(Flappy||(Flappy={}));var Flappy;!function(t){var e;!function(e){const i=112,a=109,s={colorKey:"birdColor",dieSoundKey:"die",hitSoundKey:"hit",key:"bird",windSoundKey:"wing"};class o extends Phaser.State{preload(){this.game.load.spritesheet("bird","assets/bird.png",34,24),this.game.load.spritesheet("birdColor","assets/bird-color-layer.png",34,24),this.game.load.image("sky","assets/sky.png"),this.game.load.image("floor","assets/land.png"),this.game.load.image("pipeBody","assets/pipe.png"),this.game.load.image("pipeDownCap","assets/pipe-down.png"),this.game.load.image("pipeUpCap","assets/pipe-up.png"),this.game.load.image("splash","assets/splash.png"),this.game.load.image("gameOver","assets/game-over.png"),this.game.load.image("scoreBoard","assets/score-board.png"),this.game.load.image("replay","assets/replay.png"),this.game.load.image("bronzeMedal","assets/medal-bronze.png"),this.game.load.image("silverMedal","assets/medal-silver.png"),this.game.load.image("goldMedal","assets/medal-gold.png"),this.game.load.image("platMedal","assets/medal-platinum.png"),this.game.load.audio("wing",["assets/sounds/sfx_wing.ogg","assets/sounds/sfx_wing.mp3"]),this.game.load.audio("hit",["assets/sounds/sfx_hit.ogg","assets/sounds/sfx_hit.mp3"]),this.game.load.audio("die",["assets/sounds/sfx_die.ogg","assets/sounds/sfx_die.mp3"]),this.game.load.audio("woosh",["assets/sounds/sfx_swooshing.ogg","assets/sounds/sfx_swooshing.mp3"]),this.game.load.audio("point",["assets/sounds/sfx_point.ogg","assets/sounds/sfx_point.mp3"])}create(){this.scale.scaleMode=Phaser.ScaleManager.EXACT_FIT,this.game.stage.backgroundColor="#4ec0ca",this.game.stage.disableVisibilityChange=!0,this.game.world.setBounds(t.Global.Constants.worldOffset,0,9e3,t.Global.Constants.gameHeight),this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.physics.arcade.gravity.y=t.Global.Constants.gravity,this.game.input.onDown.add(()=>{this.tutorialSplash.visible=!1}),this.sky=new t.Sky(this.game,a,"sky",i),this.pipePool=new t.PipePool(this.game,i),this.floor=new t.Floor(this.game,i,"floor"),this.bird=new t.Bird(this.game,i,t.Global.connectionDetails.color,s),this.game.camera.follow(this.bird,Phaser.Camera.FOLLOW_PLATFORMER),this.scoreCounter=new t.ScoreCounter(this.game),this.playerManager=new t.PlayerManager(this.game,s),this.playerManager.createPlayersFromServer(),this.playerManager.listen(),this.scoreBoard=new t.ScoreBoard(this.game,{bronzeMedalKey:"bronzeMedal",gameOverKey:"gameOver",goldMedalKey:"goldMedal",platinumMedalKey:"platMedal",replayButtonKey:"replay",scoreBoardKey:"scoreBoard",silverMedalKey:"silverMedal",wooshSoundKey:"woosh"},()=>{this.bird.restart(),this.scoreCounter.restart(),this.tutorialSplash.visible=!0}),this.levelRequester=new t.LevelRequester(this.scoreCounter,this.pipePool),this.tutorialSplash=new t.TutorialSplash(this.game,{key:"splash"}),window.addEventListener("resize",t=>{this.game.camera.follow(this.bird,Phaser.Camera.FOLLOW_PLATFORMER)})}update(){this.levelRequester.update(e=>{this.pipePool.addPipes(e),this.game.world.bounds.width+=t.Global.Constants.pipeSpacing*e.length}),this.scoreBoard.isGameOver||(this.game.physics.arcade.collide(this.bird,this.floor,()=>{this.bird.deathSequence(),this.scoreBoard.show(this.scoreCounter.score),this.game.camera.shake(.003,300,!0,Phaser.Camera.SHAKE_BOTH,!1)}),this.game.physics.arcade.overlap(this.bird,this.pipePool.sprites,()=>{this.bird.deathSequence(),this.scoreBoard.show(this.scoreCounter.score),this.game.camera.shake(.003,300,!0,Phaser.Camera.SHAKE_BOTH,!1)}),this.game.physics.arcade.overlap(this.bird,this.pipePool.holes,(t,e)=>{this.scoreCounter.increment(e)}))}}e.Play=o}(e=t.State||(t.State={}))}(Flappy||(Flappy={}));var Flappy;!function(t){class e extends Phaser.Sprite{constructor(e,i){super(e,t.Global.Constants.gameWidth/2,t.Global.Constants.gameHeight/2,i.key),this.fixedToCamera=!0,this.anchor.set(.5,.5),this.game.add.existing(this)}update(){this.cameraOffset.x=t.Global.Constants.gameWidth/2,this.cameraOffset.y=t.Global.Constants.gameHeight/2}}t.TutorialSplash=e}(Flappy||(Flappy={}));